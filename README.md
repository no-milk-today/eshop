# Интернет магазин

Reactive Web-приложение на Spring Boot, представляющее витрину товаров, которые пользователь может добавить в корзину и купить.

## Технологии

- **Java 21**, **Spring Boot 3.4.4 (Reactive)**
- **Gradle** – сборка проекта
- **Spring WebFlux** – реактивный стек для веб-приложений
- **Thymeleaf** – серверный шаблонизатор HTML с поддержкой JavaScript
- **Spring Data R2DBC** – реактивное взаимодействие с базой данных
- **MySQL 8.0** – база данных
- **JUnit 5** – модульные и интеграционные тесты
- **Docker**
- **Testcontainers** – тестирование с использованием контейнеров

## Сборка и запуск

1. **Поднять docker compose:**

   ```bash
   export MYSQL_USER=yourDesiredUsername
   export MYSQL_PASSWORD=yourDesiredPassword
   docker compose up -d
   ```

2. **Запуск приложения:**

Прокинуть env переменные `MYSQL_USER=значение` и `MYSQL_PASSWORD=значение`.

```bash
   $env:MYSQL_USER="значение"
   $env:MYSQL_PASSWORD="значение"
```

- **создание БД и таблиц** находятся в файле `resources/db/sql/createDBAndTables.sql`.
- Этот скрипт нужно запустить ДО старта приложения.

Затем выполнить сборку и запуск:
   ```bash
   gradlew build
   java -jar "build/libs/reactive shop-0.0.1-SNAPSHOT.jar"
   ```

- **начальные данные** находятся в файле `resources/db/sql/init-data.sql`.
- Этот скрипт нужно запустить после успешного старта приложения.

## Структура шаблонов

Папка `templates` находится в `src/main/resources`.

- **main.html** – главная витрина магазина, отображающая список всех товаров
- **item.html** – страница с описание товара (карточка товара)
- **cart.html** – страница с корзиной товаров
- **orders-list.html** – страница со списком всех заказов
- **order.html** – страница с деталями заказа

## Тестирование

- **Запуск тестов с использованием testcontainers:**

  ```bash
  ./gradlew test
  ```

  Тесты включают модульные и интеграционные, охватывающие основные компоненты приложения.

## Эндпоинты приложения

- **GET \"/\"**  
  Редирект на \"/main/items\"

- **GET \"/main/items\"**  
  Вывод списка всех товаров плиткой на главной странице

- **POST \"/main/items/{id}\"**  
  Изменение количества товара в корзине

- **GET \"/cart/items\"**  
  Вывод содержимого корзины

- **POST \"/cart/items/{id}\"**  
  Изменение количества товара в корзине

- **GET \"/items/{id}\"**  
  Карточка товара

- **POST \"/items/{id}\"**  
  Изменение количества товара в корзине

- **POST \"/buy\"**  
  Оформление покупки – выполняет покупку товаров в корзине и очищает ее

- **GET \"/orders\"**  
  Вывод списка заказов

- **GET \"/orders/{id}\"**  
  Карточка заказа